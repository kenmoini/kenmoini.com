<!-- image -->
<figure {{ with .Get "class" }}class="{{.}}"{{ end }}>
  {{- with .Get "link" }}<a href="{{ . }}">{{ end }}
    {{- $altText := "" }}
    {{- if or (.Get "alt") (.Get "caption") }}
    {{- with .Get "alt" }}
    {{- $altText = .Get "alt" }}
    {{- else }}
    {{- $altText = .Get "caption" }}
    {{- end }}
    {{- end }}
    {{- $m := (dict "src" (.Get "src") "alt" $altText) -}}
    {{ partial "func/ImageToPicture" $m }}
  {{- if .Get "link" }}</a>{{ end }}
  {{- if or (or (.Get "title") (.Get "caption")) (.Get "attr") }}
  <figcaption>{{- if isset .Params "title" }}
    <h4>{{ .Get "title" }}</h4>{{- end }}
    {{ if or (.Get "caption") (.Get "attr") }}<p>
    {{- .Get "caption" }}
    {{- with .Get "attrlink" }}<a href="{{ . }}">{{- end -}}
      {{ .Get "attr" }}
    {{- if .Get "attrlink" }}</a>{{- end -}}
    </p>{{- end }}
  </figcaption>
  {{- end }}
</figure>
<!-- image -->